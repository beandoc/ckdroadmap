<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CKD Roadmap - Dynamic Recommendations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 12px #bbb; padding: 32px; }
    h1, h2 { color: #23527c; }
    label { display: block; margin-top: 20px; font-weight: bold; }
    input[type="number"], select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
    button { margin-top: 24px; padding: 12px 32px; border: none; border-radius: 4px; background: #23527c; color: #fff; font-size: 1em; cursor: pointer; }
    button:hover { background: #183659; }
    #planOutput { margin-top: 40px; }
    ul { margin: 0 0 16px 20px; }
    .note { background: #fffae6; border-left: 4px solid #ffce36; padding: 8px 16px; border-radius: 4px; margin-bottom: 16px; }
    @media (max-width: 600px) {
      .container { padding: 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CKD Management Roadmap</h1>
    <form id="ckdForm">
      <label for="egfr">eGFR (ml/min/1.73m²):</label>
      <input type="number" min="1" max="200" step="0.1" id="egfr" required>

      <label for="albuminuria">Albuminuria:</label>
      <select id="albuminuria">
        <option value="true">Detected</option>
        <option value="false">Not detected</option>
      </select>

      <label for="t2d">Type 2 Diabetes:</label>
      <select id="t2d">
        <option value="true">Yes</option>
        <option value="false">No</option>
      </select>

      <button type="submit">Show Individualized Plan</button>
    </form>

    <div id="planOutput"></div>
  </div>
  <script>
    function getCKDPlan(eGFR, albuminuria, hasT2D) {
      const a = albuminuria;
      const d = hasT2D;

      // Albuminuria warning
      const albuminuriaNote = a ? `<div class="note"><b>Note:</b> Albuminuria detected. This multiplies the risk of cardiometabolic and kidney events.</div>` : "";

      // Shared lifestyle, risk, and monitoring
      const lifestyle = `
        <h3>Lifestyle & Diet</h3>
        <ul>
          <li>Moderate-intensity physical activity &ge;150 min/week or as tolerated</li>
          <li>Favor plant-based over animal-based foods; minimize ultra-processed foods</li>
          <li>Maintain optimal BMI (20–25 kg/m²)</li>
          <li>Avoid all tobacco products</li>
        </ul>
      `;
      const risk = `
        <h3>Risk Factor Management</h3>
        <ul>
          <li>Target SBP &lt;120 mmHg when tolerated</li>
          <li>Annual screening for albuminuria</li>
          <li>Regular home BP monitoring</li>
        </ul>
      `;

      // Stage-specific logic
      if (eGFR >= 60) {
        return `
          <h2>Stage G1–G2 (eGFR &ge;60)</h2>
          ${albuminuriaNote}
          ${lifestyle}
          <h3>Dietary Recommendations</h3>
          <ul>
            <li>Protein: 0.8 g/kg/day</li>
            <li>Sodium: &lt;2 g/day</li>
          </ul>
          <h3>Medication</h3>
          <ul>
            <li>RAASi and SGLT2i for all with albuminuria (diabetic or not)</li>
            <li>Non-steroidal MRAs (diabetic with albuminuria, persistent despite RAASi and SGLT2i)</li>
            ${d ? `<li>Metformin if eGFR &ge;30 (monitor B12 if used &gt;4 years)</li>
            <li>Individualized HbA1c target: &lt;6.5–8.0%</li>` : ""}
            <li>Statin for age &ge;50 or CVD</li>
            <li>Low-dose aspirin if established CVD</li>
          </ul>
          ${risk}
          <h3>Monitoring</h3>
          <ul>
            <li>Kidney function, creatinine, potassium: every 6–12 months</li>
            <li>After starting/increasing RAASi: check creatinine/K+ in 2–4 weeks</li>
          </ul>
        `;
      }
      if (eGFR >= 45) {
        return `
          <h2>Stage G3a (eGFR 45–59)</h2>
          ${albuminuriaNote}
          <div class="note"><b>Care Transition:</b> Consider nephrology referral.</div>
          ${lifestyle}
          <h3>Dietary Recommendations</h3>
          <ul>
            <li>Protein: 0.8 g/kg/day</li>
            <li>Sodium: &lt;2 g/day</li>
          </ul>
          <h3>Medication</h3>
          <ul>
            <li>RAASi and SGLT2i for all with albuminuria (diabetic or not)</li>
            <li>Non-steroidal MRAs (diabetic with albuminuria, persistent despite RAASi and SGLT2i)</li>
            ${d ? `<li>Metformin: Initiate if eGFR &ge;30, halve dose if eGFR 30–44</li>
            <li>Monitor B12 if used &gt;4 years</li>
            <li>Individualized HbA1c target: &lt;6.5–8.0%</li>` : ""}
            <li>Statin for age &ge;50 or CVD</li>
            <li>Low-dose aspirin if established CVD</li>
          </ul>
          ${risk}
          <h3>Monitoring</h3>
          <ul>
            <li>Kidney function, creatinine, potassium: every 3–6 months</li>
            <li>Albuminuria: every 6 months</li>
            <li>After starting/increasing RAASi: check creatinine/K+ in 2–4 weeks</li>
            <li>Bone & Mineral: Consider vitamin D, check calcium/phosphate every 6–12 months</li>
          </ul>
        `;
      }
      if (eGFR >= 30) {
        return `
          <h2>Stage G3b (eGFR 30–44)</h2>
          ${albuminuriaNote}
          <div class="note"><b>Care Transition:</b> Nephrology follow-up recommended.</div>
          ${lifestyle}
          <h3>Dietary Recommendations</h3>
          <ul>
            <li>Protein: 0.8 g/kg/day</li>
            <li>Sodium: &lt;2 g/day</li>
            <li>Monitor potassium intake</li>
          </ul>
          <h3>Medication</h3>
          <ul>
            <li>RAASi and SGLT2i for all with albuminuria (diabetic or not)</li>
            <li>Non-steroidal MRAs (diabetic with albuminuria, persistent despite RAASi and SGLT2i)</li>
            ${d ? `<li>Metformin: Use with caution, halve dose, monitor renal function every 3 months, discontinue if eGFR &lt;30</li>
            <li>Monitor B12 if used &gt;4 years</li>
            <li>Individualized HbA1c target: &lt;6.5–8.0%</li>` : ""}
            <li>Statin for age &ge;50 or CVD</li>
            <li>Low-dose aspirin if established CVD</li>
          </ul>
          ${risk}
          <h3>Monitoring</h3>
          <ul>
            <li>Kidney function, creatinine, potassium: every 3 months</li>
            <li>Albuminuria: every 6 months</li>
            <li>Bone & Mineral: Calcium/phosphate every 6 months</li>
          </ul>
        `;
      }
      if (eGFR >= 15) {
        return `
          <h2>Stage G4 (eGFR 15–29)</h2>
          ${albuminuriaNote}
          <div class="note"><b>Care Transition:</b> Interprofessional care and RRT planning.</div>
          <h3>Lifestyle & Diet</h3>
          <ul>
            <li>Protein restriction: 0.6–0.8 g/kg/day</li>
            <li>Sodium: &lt;2 g/day</li>
            <li>Gentle activity as tolerated</li>
            <li>Urgent smoking cessation</li>
            <li>Limit processed foods</li>
          </ul>
          <h3>Medication</h3>
          <ul>
            <li>Careful use of ACEi/ARBs</li>
            <li>SGLT2i if eGFR &ge;20</li>
            <li>Metformin contraindicated</li>
            <li>Statin for age &ge;50 or CVD</li>
            <li>Low-dose aspirin if established CVD</li>
            <li>Non-steroidal MRAs (diabetic with albuminuria, persistent despite RAASi and SGLT2i)</li>
          </ul>
          <h3>Advanced CKD Planning</h3>
          <ul>
            <li>Discuss dialysis/transplant options</li>
            <li>Early transplant referral if appropriate</li>
            <li>Vascular access planning</li>
            <li>Advance care planning</li>
          </ul>
          <h3>Monitoring & Bone Health</h3>
          <ul>
            <li>Kidney function, creatinine, potassium: every 1–3 months</li>
            <li>Calcium/phosphate every 3 months; iPTH every 6 months</li>
            <li>Monitor for anemia and uremic symptoms</li>
          </ul>
        `;
      }
      // eGFR < 15
      return `
        <h2>Stage G5 (eGFR &lt;15)</h2>
        ${albuminuriaNote}
        <div class="note"><b>Care Transition:</b> Access planning and RRT (dialysis/transplant) preparation required.</div>
        <h3>Lifestyle & Diet</h3>
        <ul>
          <li>Strict protein restriction: 0.6 g/kg/day</li>
          <li>Very low sodium (&lt;1.5–2 g/day)</li>
          <li>Fluid restriction as needed</li>
          <li>Gentle activity as tolerated; focus on maintaining mobility</li>
          <li>No tobacco or alcohol</li>
        </ul>
        <h3>Medication</h3>
        <ul>
          <li>Metformin contraindicated</li>
          <li>SGLT2i generally discontinued</li>
          <li>Adjust/stop ACEi/ARBs as indicated</li>
          <li>Statin for age &ge;50 or CVD</li>
          <li>Low-dose aspirin if established CVD</li>
          <li>Non-steroidal MRAs (diabetic with albuminuria, persistent despite RAASi and SGLT2i)</li>
        </ul>
        <h3>Kidney Replacement Preparation</h3>
        <ul>
          <li>Urgent nephrology referral if not already done</li>
          <li>Dialysis education and modality selection</li>
          <li>Vascular access planning and creation</li>
          <li>Transplant evaluation if appropriate</li>
          <li>Conservative care discussion if preferred</li>
          <li>Advance care planning</li>
        </ul>
        <h3>Monitoring & Bone Health</h3>
        <ul>
          <li>Monthly or more frequent lab monitoring</li>
          <li>Calcium/phosphate monthly; iPTH every 3 months</li>
          <li>Monitor fluid/nutritional status, manage uremic symptoms</li>
        </ul>
      `;
    }

    document.getElementById('ckdForm').onsubmit = function(e) {
      e.preventDefault();
      const egfr = parseFloat(document.getElementById('egfr').value);
      const albuminuria = document.getElementById('albuminuria').value === "true";
      const t2d = document.getElementById('t2d').value === "true";
      document.getElementById('planOutput').innerHTML = getCKDPlan(egfr, albuminuria, t2d);
      window.scrollTo({ top: document.getElementById('planOutput').offsetTop - 60, behavior: 'smooth' });
    };
  </script>
</body>
</html>
